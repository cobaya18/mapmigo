<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>MapMigo ‚Äî Puerto Rico</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- PWA / Icons -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#f3f4f6">
  <link rel="apple-touch-icon" href="./icons/icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">

  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
    crossorigin=""
  />

  <!-- MarkerCluster CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"
  />
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"
  />

  <!-- Custom Styles -->
  <link rel="stylesheet" href="./styles.css" />
</head>

<body>
  <div id="appRoot">
    <!-- TOP BAR -->
    <header id="topBar">
      <div id="logoArea">
        <div id="logoEmoji">üó∫Ô∏è</div>
        <div id="logoTextGroup">
          <div id="logoTitle">MapMigo</div>
          <div id="logoSubtitle">Puerto Rico</div>
        </div>
      </div>

      <div id="searchArea">
        <div id="searchBarWrapper">
          <input
            id="searchInput"
            type="text"
            placeholder="Search by name, city, category..."
            autocomplete="off"
          />
          <button id="searchClearButton" class="icon-btn" aria-label="Clear search">
            ‚úï
          </button>
        </div>
        <!-- end searchBarWrapper -->

        <!-- Search results overlay (moved inside topBar/searchArea) -->
        <div id="searchResults">
          <div class="search-results-header">
            <span>Search results</span>
            <button id="searchResultsClose" class="icon-btn" aria-label="Close search results">‚úï</button>
          </div>
          <div id="searchResultsList"></div>
        </div>
      </div>

      <div id="topBarButtons">
        <button id="filtersButton" class="primary-btn" aria-label="Open filters">
          Filters
        </button>
        <button id="favoritesButton" class="icon-btn" aria-label="View favorites">
          ‚òÖ
        </button>
        <button id="listViewButton" class="icon-btn only-desktop" aria-label="Open list view">
          ‚ò∞
        </button>
      </div>
    </header>

    <!-- MAIN LAYOUT -->
    <div id="layoutRoot">
      <!-- SIDEBAR (filters + favorites) -->
      <aside id="sidebar">
        <div id="sidebarScroll">
          <section class="sidebar-section">
            <div class="sidebar-section-header">
              <h2>Filters</h2>
              <button id="clearFiltersButton" class="text-btn">Clear all</button>
            </div>

            <div class="sidebar-subsection">
              <h3>Categories</h3>
              <div id="categoryFilters" class="chip-group"></div>
            </div>

            <div class="sidebar-subsection">
              <h3>Regions</h3>
              <div id="regionFilters" class="chip-group"></div>
            </div>
          </section>

          <section class="sidebar-section">
            <div class="sidebar-section-header">
              <h2>Favorites</h2>
              <button id="clearFavoritesButton" class="text-btn">
                Clear
              </button>
            </div>
            <div id="favoritesEmptyState" class="empty-state">
              <div class="empty-emoji">‚≠ê</div>
              <div class="empty-title">No favorites yet</div>
              <div class="empty-body">
                Tap the star on any place to save it here.
              </div>
            </div>
            <div id="favoritesList" class="place-list"></div>
          </section>
        </div>
      </aside>

      <!-- SIDEBAR OVERLAY (mobile) -->
      <div id="sidebarOverlay"></div>

      <!-- MAP AREA -->
      <main id="mapArea">
        <div id="mapContainer">
          <div id="map"></div>

          <!-- Map controls -->
          <div id="mapControls">
            <button id="gpsButton" class="floating-btn" aria-label="Locate me">
              üìç
            </button>

            <div id="mapStyleControl" class="floating-dropdown">
              <button id="mapStyleButton" class="floating-btn" aria-label="Map style">
                üó∫
              </button>
              <div id="mapStyleMenu" class="floating-menu">
                <button data-style-id="streets">Streets</button>
                <button data-style-id="satellite">Satellite</button>
                <button data-style-id="outdoors">Outdoors</button>
              </div>
            </div>
          </div>

          <!-- Map skeleton loader -->
          <div id="mapSkeleton" class="map-skeleton">
            <div class="skeleton-header"></div>
            <div class="skeleton-lines"></div>
          </div>
        </div>
      </main>
    </div>

    <!-- LIST VIEW OVERLAY -->
    <div id="listViewOverlay">
      <div id="listViewSheet">
        <header id="listViewHeader">
          <button id="listViewCloseButton" class="icon-btn" aria-label="Close list view">
            ‚úï
          </button>
          <div class="list-view-title-group">
            <h2>Places</h2>
            <div id="listViewCount" class="list-count"></div>
          </div>
        </header>

        <div id="listViewContent">
          <div id="listViewEmptyState" class="empty-state">
            <div class="empty-emoji">üîç</div>
            <div class="empty-title">No places to show</div>
            <div class="empty-body">
              Try adjusting your search or filters.
            </div>
          </div>
          <div id="listViewPlaces" class="place-list"></div>
        </div>
      </div>
    </div>

    <!-- MOBILE PLACE SHEET -->
    <div id="mobilePlaceSheet">
      <div id="mobileSheetHandle"></div>
      <div id="mobileSheetContent"></div>
    </div>
  </div>

  <!-- App entry -->
  <script type="module" src="./app.js"></script>

  <!-- Service worker -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("./service-worker.js")
          .catch((err) => console.log("SW registration failed", err));
      });
    }
  </script>

</body>
</html>
